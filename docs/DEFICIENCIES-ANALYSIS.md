# ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö RMU-Campus X

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå codebase (‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢, API, ‡∏Å‡∏≤‡∏£ validate, error handling) ‚Äî ‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô SYSTEM-ANALYSIS.md ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

---

## üî¥ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á)

### 1. Admin routes ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô

**‡πÑ‡∏ü‡∏•‡πå:**  
- `app/api/admin/users/[id]/status/route.ts`  
- `app/api/admin/users/[id]/warning/route.ts`

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà `verifyIdToken(token)` ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ  
- **‡πÑ‡∏°‡πà‡∏°‡∏µ** `verifyAdminAccess()` ‡∏´‡∏£‡∏∑‡∏≠ `isAdmin()`  
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å POST ‡πÑ‡∏î‡πâ

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- ‡∏ú‡∏π‡πâ‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ (ACTIVE ‚Üí SUSPENDED/BANNED)  
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (warning) ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ  
- ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡πÉ‡∏ä‡πâ `verifyAdminAccess(request)` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô route ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô `/api/admin/*`  
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡πâ return error ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (401/403)

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á route ‡πÉ‡∏ä‡πâ `verifyAdminAccess(req)` ‡πÅ‡∏•‡∏∞ validate body ‡∏î‡πâ‡∏ß‡∏¢ `updateUserStatusSchema` / `issueWarningSchema`

---

### 2. Admin PATCH `/api/admin/users/[id]` ‚Äî ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏î‡πâ‡∏ß‡∏¢ raw body

**‡πÑ‡∏ü‡∏•‡πå:** `app/api/admin/users/[id]/route.ts`

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
```ts
const body = await request.json()
await db.collection('users').doc(id).update(body)
```  
- ‡πÑ‡∏°‡πà‡∏°‡∏µ schema (Zod) ‡∏´‡∏£‡∏∑‡∏≠ allowlist ‡∏Ç‡∏≠‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå  
- Body ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firestore

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ token ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô) ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô `email`, `createdAt`, `warningCount`, `restrictions`  
- ‡∏≠‡∏≤‡∏à‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏´‡∏£‡∏∑‡∏≠ inject ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å API ‡∏ô‡∏µ‡πâ

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î schema (‡πÄ‡∏ä‡πà‡∏ô Zod) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏Å‡πâ (‡πÄ‡∏ä‡πà‡∏ô `displayName`, `status`, `bio`)  
- ‡πÉ‡∏ä‡πâ `parsed.data` ‡∏Å‡∏±‡∏ö `update()` ‡πÅ‡∏ó‡∏ô raw `body`  
- ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏ä‡πà‡∏ô `uid`, `email` ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Auth)

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡πÉ‡∏ä‡πâ `adminUserPatchSchema` (Zod) allowlist: displayName, bio, photoURL, status; `.strict()`; ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞ `parsed.data` + updatedAt; ‡πÉ‡∏ä‡πâ `sanitizeText` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

---

### 3. Admin PATCH `/api/admin/reports/[id]` ‚Äî ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏î‡πâ‡∏ß‡∏¢ raw body

**‡πÑ‡∏ü‡∏•‡πå:** `app/api/admin/reports/[id]/route.ts`

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- `await db.collection('reports').doc(id).update(body)` ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ validation

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- ‡∏≠‡∏≤‡∏à‡πÅ‡∏Å‡πâ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö business rule

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡πÉ‡∏ä‡πâ schema (Zod) ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πà‡∏ô `status`, `adminNote`, `resolvedAt`) ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ô‡∏±‡πâ‡∏ô

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡πÉ‡∏ä‡πâ `reportPatchSchema` (status, adminNote, resolvedAt); ‡∏™‡∏£‡πâ‡∏≤‡∏á `updates` ‡∏à‡∏≤‡∏Å parsed data ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô; ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ resolvedAt/handledBy ‡∏ï‡∏≤‡∏° business rule

---

## üü† ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á)

### 4. ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏•‡∏∞ validation ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡∏ö‡∏≤‡∏á route ‡πÉ‡∏ä‡πâ `withValidation` / `withAuth` / `withAdminAuth`  
- ‡∏ö‡∏≤‡∏á route ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ token ‡πÄ‡∏≠‡∏á (`requireAuth`, `getAuthToken` + `verifyIdToken`)  
- ~~‡∏ö‡∏≤‡∏á route ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ admin (‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠ 1)~~ ‚Äî ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏•‡∏∑‡∏°‡πÄ‡∏ä‡πá‡∏Ñ auth ‡∏´‡∏£‡∏∑‡∏≠ terms ‡πÉ‡∏ô route ‡πÉ‡∏´‡∏°‡πà  
- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡πÉ‡∏ä‡πâ wrapper ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô admin ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πâ `verifyAdminAccess` ‡∏à‡∏≤‡∏Å `admin-api`)  
- ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ refactor route ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `withValidation`/`withAuth`/`withAdminAuth` ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà

---

### 5. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö response ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô `{ success: true, item }` ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô `{ success: true, data: { ... } }`  
- ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ `ApiErrors.*` / `errorResponse` ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ `NextResponse.json({ error: "..." })`  
- error code (`code`) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- Frontend ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö  
- ‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ error handling ‡πÅ‡∏•‡∏∞ monitoring ‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô success: `{ success: true, data }`, error: `{ success: false, error, code?, details? }`)  
- ‡πÉ‡∏ä‡πâ helper ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (`lib/api-response.ts` ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤) ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å API route

---

### 6. Rate limit ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° GET

**‡πÑ‡∏ü‡∏•‡πå:** `middleware.ts`

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ method ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà read-only (GET/HEAD/OPTIONS) ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å rate limit  
- GET ‡∏ñ‡∏π‡∏Å‡∏Ç‡πâ‡∏≤‡∏°

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ endpoint GET ‡∏ó‡∏µ‡πà costly (‡πÄ‡∏ä‡πà‡∏ô query ‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠ aggregate) ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏¢‡∏¥‡∏á‡∏ã‡πâ‡∏≥‡∏à‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô Firestore ‡∏™‡∏π‡∏á  
- ‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÅ‡∏ö‡∏ö scrape ‡∏´‡∏£‡∏∑‡∏≠ enumeration ‡∏ú‡πà‡∏≤‡∏ô GET ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ rate limit GET ‡πÅ‡∏¢‡∏Å (‡πÄ‡∏ä‡πà‡∏ô limit ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ write) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö path ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á  
- ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ key ‡πÅ‡∏¢‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö read ‡∏Å‡∏±‡∏ö write ‡πÉ‡∏ô Upstash

---

### 7. withAuth / withAdminAuth ‡πÑ‡∏°‡πà‡∏°‡∏µ try/catch ‡∏£‡∏≠‡∏ö handler

**‡πÑ‡∏ü‡∏•‡πå:** `lib/api-validation.ts`

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡πÉ‡∏ô `withAuth` / `withAdminAuth` ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏î‡πâ context ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞ `return handler(request, context)` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á  
- ‡∏ñ‡πâ‡∏≤ `handler` throw ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏ö‡πÉ‡∏ô wrapper

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**  
- Error ‡∏ó‡∏µ‡πà throw ‡πÉ‡∏ô handler ‡∏≠‡∏≤‡∏à‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô 500 ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ leak stack/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡∏´‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å handler ‡∏î‡πâ‡∏ß‡∏¢ try/catch ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∑‡∏ô error response ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö `withValidation` (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ `withErrorHandler`)

---

## üü° ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤

### 8. ‡∏Å‡∏≤‡∏£ parse body ‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà validate ‡∏ö‡∏≤‡∏á route

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡∏´‡∏•‡∏≤‡∏¢ route ‡πÉ‡∏ä‡πâ `await request.json()` ‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Zod ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Ñ‡πà‡∏î‡∏∂‡∏á field  
- Route ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö body ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ `withValidation` ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏Å‡∏¥‡∏ô

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**  
- `line/notify-item`, `line/notify-chat`, `line/notify-exchange` ‡∏£‡∏±‡∏ö body ‡πÄ‡∏õ‡πá‡∏ô type assertion ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ schema

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡πÉ‡∏ä‡πâ Zod (‡∏´‡∏£‡∏∑‡∏≠ schema ‡∏≠‡∏∑‡πà‡∏ô) ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å route ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö body  
- ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ä‡πâ `withValidation` ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å helper ‡πÅ‡∏ö‡∏ö parse + validate

---

### 9. Admin: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á collection `admins` ‡∏Å‡∏±‡∏ö‡∏Å‡∏é‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**  
- Firestore rules: `isAdmin()` = ‡∏°‡∏µ document ‡∏ó‡∏µ‡πà `admins/$(request.auth.uid)`  
- ‡∏ù‡∏±‡πà‡∏á API: ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `adminsRef.where('email', '==', userEmail)`  
- ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏•‡∏Ñ‡∏∑‡∏≠ `admins/{uid}` ‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå `email`, `role`

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**  
- ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á doc ‡∏ó‡∏µ‡πà key ‡∏î‡πâ‡∏ß‡∏¢ uid ‡πÅ‡∏•‡∏∞‡∏î‡πâ‡∏ß‡∏¢ email ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏¥‡∏î document  
- ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠ comment ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ admins ‡πÉ‡∏ä‡πâ document id ‡πÄ‡∏õ‡πá‡∏ô uid ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå email

---

### 10. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÅ‡∏•‡∏∞ logging

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- ‡∏ö‡∏≤‡∏á route ‡πÅ‡∏Ñ‡πà `console.error` ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ Sentry/monitoring  
- ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ `SystemLogger.logError` ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ  
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö client ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á `error.message` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‚Äî ‡∏≠‡∏≤‡∏à leak ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (‡πÄ‡∏ä‡πà‡∏ô 4xx ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á Sentry, 5xx ‡∏™‡πà‡∏á)  
- ‡πÉ‡∏ä‡πâ logger/monitoring ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö API  
- ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á stack ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° internal ‡πÑ‡∏õ‡∏ó‡∏µ‡πà client; ‡πÉ‡∏ä‡πâ code ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô

---

### 11. LINE internal endpoints (notify-*)

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**  
- `notify-item`, `notify-chat`, `notify-exchange`, `notify-admin` ‡∏Ø‡∏•‡∏Ø ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà Bearer token (verifyIdToken)  
- ‡∏ñ‡πâ‡∏≤ endpoint ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å frontend ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏¥‡∏á request ‡∏õ‡∏•‡∏≠‡∏°‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á notification ‡∏õ‡∏•‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏¥‡∏á‡∏ã‡πâ‡∏≥)

**‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô:**  
- ‡∏ñ‡πâ‡∏≤ endpoint ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å server-side ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô Cloud Functions, API ‡∏≠‡∏∑‡πà‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô) ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥  
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å client ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ shared secret ‡∏´‡∏£‡∏∑‡∏≠ server-to-server auth ‡πÅ‡∏ó‡∏ô/‡πÄ‡∏™‡∏£‡∏¥‡∏°

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ:**  
- ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤ notify-* ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô  
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å client ‡πÑ‡∏î‡πâ ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ API key / secret / server-only

---

## ‡∏™‡∏£‡∏∏‡∏õ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

| ‡∏•‡∏≥‡∏î‡∏±‡∏ö | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ |
|------|--------|------------|--------|
| 1 | Admin status/warning ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ isAdmin | ~~üî¥ ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å~~ | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß |
| 2 | Admin PATCH users/[id] ‚Äî raw body update | ~~üî¥ ‡∏™‡∏π‡∏á~~ | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß |
| 3 | Admin PATCH reports/[id] ‚Äî raw body update | ~~üî¥ ‡∏Å‡∏•‡∏≤‡∏á~~ | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß |
| 4 | API auth/validation ‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ | üü† ‡∏Å‡∏•‡∏≤‡∏á | Refactor ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ |
| 5 | ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö response ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô | üü† ‡∏Å‡∏•‡∏≤‡∏á | ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + helper |
| 6 | Rate limit ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° GET | üü† ‡∏ï‡πà‡∏≥‚Äì‡∏Å‡∏•‡∏≤‡∏á | ‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ |
| 7 | withAuth/withAdminAuth ‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö error | üü† ‡∏Å‡∏•‡∏≤‡∏á | ‡πÄ‡∏û‡∏¥‡πà‡∏° try/catch |
| 8 | Body ‡πÑ‡∏°‡πà validate ‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢ route | üü° ‡∏ï‡πà‡∏≥ | ‡πÄ‡∏û‡∏¥‡πà‡∏° Zod ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç |
| 9 | ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á admins vs rules | üü° ‡∏ï‡πà‡∏≥ | ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/comment |
| 10 | Error handling ‡πÅ‡∏•‡∏∞ logging ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå | üü° ‡∏ï‡πà‡∏≥ | ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á |
| 11 | LINE notify-* ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏ô | üü° ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö use case | ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢ |

---

## ‚úÖ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)

| ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |
|--------|--------|
| Admin status/warning ‚Äî ‡πÉ‡∏ä‡πâ `verifyAdminAccess` + Zod schema | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß |
| Admin PATCH users/[id] ‚Äî ‡πÉ‡∏ä‡πâ `adminUserPatchSchema` allowlist + sanitizeText | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß |
| Admin PATCH reports/[id] ‚Äî ‡πÉ‡∏ä‡πâ `reportPatchSchema` + ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß |

---

## ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≤‡∏Å codebase ‡πÅ‡∏•‡∏∞ SYSTEM-ANALYSIS.md)

- LINE Webhook: ‡∏ï‡∏£‡∏ß‡∏à signature ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•  
- Exchanges GET/PATCH: ‡∏°‡∏µ auth ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à participant + state machine  
- termsAccepted: ‡∏°‡∏µ `requireTermsAccepted` ‡πÉ‡∏ô validation wrapper ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô POST ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á  
- User doc ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å auth-provider: ‡∏°‡∏µ warningCount + restrictions ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö registerUser  
- Firestore rules: ‡∏ï‡∏£‡∏ß‡∏à isAdmin, isActiveUser, ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á  
- Rate limit (Upstash): ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö API write ‡πÅ‡∏•‡πâ‡∏ß  
- API validation: ‡∏°‡∏µ withValidation + Zod ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢ route ‡πÅ‡∏•‡πâ‡∏ß  

---

*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å codebase ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥‡∏´‡∏•‡∏±‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠ deploy*
